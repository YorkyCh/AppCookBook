{% extends 'base.html' %}
{% load widget_tweaks %}
{% block extra_head %}
<style>
  .item {
  width: 200px;
  height: 100px;
  margin: 10px;
  text-align: center;
  line-height: 100px;
}
</style>
{{ block.super }}
{% endblock %}

{% block content %}
<header>
  <nav>
    <div class="navbar-left">
      <h1><a href="{% url 'index' %}">Pollo Cookbook</a></h1>
      <h1><a href="{% url 'recipe_list' %}" style="margin-right: 10px;">List</a></h1>

    </div>
    <div class="navbar-right">
      <div>
        <form id="search-input" method="get" action="{% url 'recipe_search' %}">
          <div class="search-form-elements">
            <input type="search" class="form-control input-thick-border" id="test" placeholder="Search..." name="keyword" />
          </div>
        </form>
      </div>
      <div>
        <a href="{% url 'add_recipe' %}">add recipe</a>
      </div>
    </div>
  </nav>
</header>
<div class="main-block" style="margin-top: 190px; display: flex; flex-direction: column; align-items: center;">
  <h1>Add Recipe</h1>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}


    <div>
      <label for="{{ form.name.id_for_label }}">Name:</label>
      <div>
      {{ form.name }}
      </div>
    </div>


    <div>
      <label for="{{ form.description.id_for_label }}">Description:</label>
      {{ form.description }}
      <div style="float:right">
        <h3>Categories:</h3>
    {% for category in categories %}
    <div>
      <input type="checkbox" name="categories" value="{{ category.pk }}" id="category_{{ category.pk }}"
             {% if category in form.initial.categories.all %}checked{% endif %}>
      <label for="category_{{ category.pk }}">{{ category.name }}</label>
    </div>
    {% endfor %}
      </div>
    </div>



    <div>
      <label for="{{ form.preparation_time.id_for_label }}">Preparation Time:</label>
      <div>
      {{ form.preparation_time }} minutes
      </div>
    </div>


    <div>
      <label for="{{ form.image.id_for_label }}">Image:</label>
      <div>
      {{ form.image }}
     </div>
    </div>


    <div>
      <label for="{{ form.spiciness.id_for_label }}">Spiciness:</label>
      <div>
      {{ form.spiciness }}
      </div>
    </div>


    <div>
      <label for="{{ form.steps.id_for_label }}">Steps:</label>
      <div>
      {{ form.steps }}
      </div>
    </div>

    <div>
      <label for="{{ form.portion_size.id_for_label }}">Portion Size:</label>
      <div>
        {{ form.portion_size }}
      </div>
    </div>

    <div>
    <h3>Ingredients:</h3>
    </div>
    <div>
    {{ formset.management_form }}
    </div>
    <div id="ingredients-container">
      {% for form in formset %}
      <div class="ingredient-input">
        {{ form.id }}
        <div class="ingredient-field">
          {{ form.ingredient.label_tag }} {{ form.ingredient }}
        </div>
        <div class="amount-field">
          {{ form.amount.label_tag }} {{ form.amount }}
        </div>
        <div class="unit-field">
          {{ form.unit|add_class:"ingredient-select" }}
        </div>
        <div class="remove-button">
          <button type="button" class="remove-ingredient-btn" style="
            background-color: #ff6f00;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
          ">Remove</button>
        </div>
      </div>
      {% endfor %}
    </div>
    <button type="button" id="add-ingredient-btn" style="
    background-color: #ff6f00;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  ">Add Ingredient</button>
    <button type="submit" style="
    background-color: #ff6f00;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-left: 30 0px;
    margin-top: 10px;
  ">Create Recipe</button>
  </form>
  </div>
</div>

<script>
$(document).ready(function() {
  var formCount = $('#id_ingredients-TOTAL_FORMS').val();
  var ingredientForm = $('#ingredients-container').children('.ingredient-input').first().clone();

  $('#add-ingredient-btn').click(function(e) {
    e.preventDefault();
    var newForm = ingredientForm.clone();
    newForm.find('input, select').each(function() {
      var name = $(this).attr('name').replace('-0-', '-' + formCount + '-');
      var id = 'id_' + name;
      $(this).attr({
        'name': name,
        'id': id
      }).val('').removeAttr('checked');
    });
    newForm.find('.remove-ingredient-btn').click(removeIngredient); // Add event listener to remove button
    $('#ingredients-container').append(newForm);
    formCount++;
    $('#id_ingredients-TOTAL_FORMS').val(formCount);

    // Initialize Select2 for the newly added ingredient and unit fields
    initializeSelect2(newForm.find('.ingredient-select'));
    initializeSelect2(newForm.find('.unit-select'));
  });

  // Initialize Select2 for the initial ingredient and unit fields
  initializeSelect2($('.ingredient-select'));
  initializeSelect2($('.unit-select'));

  // Event listener for remove button
  $('.remove-ingredient-btn').click(removeIngredient);

  // Function to remove ingredient form
  function removeIngredient() {
    var form = $(this).closest('.ingredient-input');
    form.remove();
    formCount--;
    $('#id_ingredients-TOTAL_FORMS').val(formCount);
  }

  // Function to initialize Select2
  function initializeSelect2(element) {
    element.select2({
      width: 'resolve'
    });
  }
});

// Reinitialize Select2 after the formset is submitted
$(document).on('submit', 'form', function() {
  $('.ingredient-select, .unit-select').select2('destroy');
});
</script>
{% endblock %}

